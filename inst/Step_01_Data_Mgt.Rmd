---
title: \sffamily{\bfseries{\LARGE Criminal History Records Paper Step 1 (Data Management)}}
geometry: "left=.5in,right=.5in,top=.75in,bottom=.75in"
author: "Steven J. Pierce"
output:
 pdf_document:
   latex_engine: xelatex
   number_sections: true
   toc: yes
   toc_depth: 3
   includes:
     in_header: "../compact-title.tex"
urlcolor: blue
header-includes:
- \usepackage{fancyhdr}
- \usepackage[yyyymmdd,hhmmss]{datetime}
- \usepackage{lastpage}
- \usepackage{fontspec}
- \defaultfontfeatures{Ligatures=TeX}
- \usepackage[font={small}, margin=1cm, skip=2pt]{caption}
- \usepackage{url}
- \usepackage{floatrow}
- \floatplacement{figure}{!ht}
- \floatplacement{table}{!ht}
- \usepackage{placeins}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{dcolumn}
- \usepackage{titling}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \pretitle{\begin{center}\LARGE\bfseries}
- \posttitle{\end{center}}
- \pagestyle{fancy}
- \lhead{SSA CHR Paper Step 1 Data Mgt}
- \rhead{\today\ \currenttime}
- \lfoot{\texttt{\small \detokenize{`r sub(".Rmd", ".pdf", knitr:::current_input(dir = FALSE))`}}} 
- \cfoot{ }
- \fancyfoot[R]{\thepage\ of \pageref*{LastPage}}
- \renewcommand{\headrulewidth}{0.4pt}
- \renewcommand{\footrulewidth}{0.4pt}
- \fancypagestyle{plain}{\pagestyle{fancy}}
---

********************************************************************************  
\FloatBarrier

# Purpose.
This file imports copies of publicly archived data files (Campbell, 2019) into 
R, then performs data management to prepare a new data file for a descriptive 
paper about the criminal histories of suspected serial sexual offenders.  

\FloatBarrier

# Setup
Set global R chunk options (local chunk options will over-ride global options). 

``` {r global_options}
# Global chunk options (over-ridden by local chunk options)
knitr::opts_chunk$set(include  = TRUE, echo = TRUE, error = TRUE, 
                      message = TRUE, warning = TRUE)
```

Load R packages that we need to get additional functions. 

``` {r load_packages}
library(here)             # for here()
library(dplyr)            # for %>%, filter(), group_by(), & summarise()
library(tidyr)            # for arrange(), filter(), group_by(), mutate(),  
                          # spread(), summarise(), %>%, etc. 
library(rmarkdown)        # for render()
library(knitr)            # for kable()
options(kableExtra.latex.load_packages = FALSE)
library(kableExtra)       # for kable_styling(), add_header_above(), column_spec(),
                          # collapse_rows(), and landscape()
library(descr)            # For freq().
options(descr.plot=FALSE) # Make freq() & crosstab() skip plots by default.
library(lubridate)        # For date conversion, eg. ymd(), time_length().
library(sjlabelled)       # For set_label(), get_label()
library(haven)            # for read_spss()
library(lattice)          # For xyplot(), bwplot(), etc. 
library(plyr)             # For mapvalues()
library(psych)            # For describe()
library(car)              # For recode()
library(SSACHR)           # for rvlabel()
```

Create objects to hold settings we plan to reuse often. 

```{r my_settings}
# Custom settings for use with bwplot().
my.boxes <- list(box.rectangle = list(col = "black", lwd = 2), 
                 box.umbrella = list(col = "black", lwd = 2))
```

\FloatBarrier

# Import Files
The SPSS files we will need to import, plus docmentation about their contents
and relationships between them, are available from an online archive (Campbell,
2019).

\FloatBarrier

## Core Criminal History Records (CHR) Files
Import the SPSS data files for the five core types of records comprising
Michigan criminal history records (CHR): offenders (IDN), incidents (INC),
arrest offenses (ARR), prosecutor charges (CHG), and judicial charges (JUD). 
See Campbell (2019) for details on these files. 

The variables we are updating with *rvlabel()* all have user-missing values with
labels that contain parentheses that are problematic when supplied to the 
*user.missing* argument in *freq()*, so we just remove the parentheses from the 
labels at import.

```{r import_IDN}
read_sav(here::here("./inst/extdata/SSA_IDN_Offenders_2018-09-03.sav"), 
         user_na = TRUE) -> 
  IDN
```

```{r import_INC}
read_sav(here::here("./inst/extdata/SSA_INC_Incidents_Imputed_2018-09-03.sav"), 
         user_na = TRUE) ->
  INC
```

```{r import_ARR}
read_sav(here::here("./inst/extdata/SSA_ARR_Arrests_Imputed_2018-09-03.sav"), 
         user_na = TRUE) %>% 
  # Replace user-missing value labels.
  mutate(ACat12 = rvlabel(ACat12),
         ACat10 = rvlabel(ACat10),
         ACat04 = rvlabel(ACat04)) ->
  ARR
```

```{r import_CHG}
read_sav(here::here("./inst/extdata/SSA_CHG_PA_Charges_Imputed_2018-09-03.sav"), 
         user_na = TRUE) %>% 
  # Replace user-missing value labels.
  mutate(CCat12 = rvlabel(CCat12),
         CCat10 = rvlabel(CCat10),
         CCat04 = rvlabel(CCat04)) ->
  CHG
```

```{r import_JUD}
read_sav(here::here("./inst/extdata/SSA_JUD_Judicial_Charges_Imputed_2018-09-03.sav"), 
         user_na = TRUE) %>% 
  # Replace user-missing value labels.
  mutate(JCat12 = rvlabel(JCat12),
         JCat10 = rvlabel(JCat10),
         JCat04 = rvlabel(JCat04)) ->
  JUD
```

```{r create_CON}
# Create a subset of JUD containing only charges where offender was convicted.
JUD %>% 
  # Retain a subset of JUD records based on disposition.
  filter(JDispCat == 1) %>% 
  # Add a variable to CON to simplify aggregation later. 
  mutate(NCON = 1) ->
  CON
```

\FloatBarrier

## Additional Data Files
We may or may not need these additional data files. We will come back and edit 
this section later to remove anything we don't need. See Campbell (2019) for 
details on these files. 

``` {r import_other}
# Read SPSS data files.
ESC <- read_sav(here::here("./inst/extdata/ESCALATIONdata_2018-05-15.sav"), 
                user_na = TRUE)
FOR <- read_sav(here::here("./inst/extdata/Forensic_Outcomes_2018-04-03.sav"), 
                user_na = TRUE)
PER <- read_sav(here::here("./inst/extdata/PERPdata_2018-04-03.sav"), 
                user_na = TRUE)
SPD <- read_sav(here::here("./inst/extdata/SAK_PERP_2018-04-03.sav"), 
                user_na = TRUE)
SAK <- read_sav(here::here("./inst/extdata/SAKdata_2018-04-03.sav"), 
                user_na = TRUE) 
```

\FloatBarrier

# Criminal History Record (CHR) Count Overview
Below is a summary of the record counts for different types of CHR records, 
along with the numbers of unique incidents and unique offenders represented in
those records. It also shows the range of event dates associated with each 
record type (i.e., birth, incident, arrest, charge, and adjudication dates). 

```{r chr_overview, warning = FALSE}
# Summarize record counts.
CHR.RC <- rbind(dfsummary(IDN, label = "Offenders", dvar = IDN$DOB),
                dfsummary(INC, label = "Incidents", dvar = INC$IDate), 
                dfsummary(ARR, label = "Arrest offenses", dvar = ARR$ADate),
                dfsummary(CHG, label = "Prosecutor charges", dvar = CHG$CDate),
                dfsummary(JUD, label = "Adjudicated charges (all dispositions)", 
                          dvar = JUD$JDate),
                dfsummary(CON, label = "Adjudicated charges (convictions)", 
                          dvar = CON$JDate))
kable(CHR.RC, caption = "Criminal History Record Counts and Date Ranges", 
      format.args = list(big.mark = ','))
```

\FloatBarrier

# Offender-Level Summaries
We have few offender-level demographic variables that are worth reporting (we 
will omit summarizing height, weight, hair color, & eye color). After examining
sex, race, and age, we switch focus to looking at descriptive data about the 
criminal history records for arrests, prosecutor charges, and adjudicated 
charges. 

All the CHR summaries in this section focus on variables that have been 
aggregated to offender level. That is why the sample size for all of these
variables is N = 1,143 (the number of offenders for whom Michigan CHR data were
available). 

\FloatBarrier

## Sex
```{r}
kable(freq(as_factor(IDN$Sex)),  digits = 2, caption = "Offender Sex")
```

\FloatBarrier

## Race
```{r}
kable(freq(as_factor(IDN$Race), user.missing = "Unknown"),  digits = 2, 
      caption = "Offender Race")
```

\FloatBarrier

## Age (as of 04/15/2016)
```{r, fig.height = 2}
CNums  <- c(2:4,8,9,11:12, 14:16)
CNames <- c("N", "Mean", "SD", "Min", "Max", "Skew", "Kurtosis", "Q25", "Q50", 
            "Q75")
Age <- describe(IDN[, "Age"],  quant=c(.25, .50, .75))
kable(Age[, CNums], digits = 2, col.names = CNames,
      caption = "Offender Age (as of 04/15/2016)")
bwplot(~ Age, data = IDN, factor = 9, xlim = c(18, 82),
       panel = panel.mybox, par.settings = my.boxes,
       xlab = "Offender Age (as of 04/15/2016)")
```

\FloatBarrier

## CHR Record Counts
We aggregated data to count how many CHR records of each type are associated 
with each offender. We summarize the resulting variables (NINC, NARR, NCHG, 
NJUD, & NCON) below.

```{r}
## Aggregate by OID into a conviction charge count variable. 
CON2 <- aggregate(NCON ~ OID, data = CON, FUN=sum)

# Merge NCON conviction charge count variable into IDN.
IDN <- merge(x = IDN, y = CON2, by = "OID", all.x = TRUE)

# Recode NCON variable to replace NA with 0. 
IDN$NCON[is.na(IDN$NCON)] <- 0
  
# Summarize CHR record counts.
RC <- describe(IDN[, c("NINC", "NARR", "NCHG", "NJUD", "NCON")],  
               quant=c(.25, .50, .75))
row.names(RC) <- c("No. of incidents", 
                   "No. of arrest offenses", 
                   "No. of prosecutor charges", 
                   "No. of adjudicated charges (all)",
                   "No. of adjudicated charges (convictions)")
kable(RC[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Record Counts (All Crime Categories)")

kable(freq(IDN$NINC), digits = 2, 
      caption = "Number of Incidents (All Crime Categories)")

kable(freq(IDN$NARR), digits = 2,
      caption = "Number of Arrest Offenses (All Crime Categories)")

kable(freq(IDN$NCHG), digits = 2,
      caption = "Number of Prosecutor Charges (All Crime Categories)")

kable(freq(IDN$NJUD), digits = 2,
      caption = "Number of Adjudicated Charges (All Crime Categories, All Dispositions)")

kable(freq(IDN$NCON), digits = 2,
      caption = "Number of Adjudicated Charges (All Crime Categories, Convictions)")
```

```{r , fig.height = 3}
# Rearrange data so we can easily plot multiple variables. 
IDNW <- gather(data = IDN[, c("OID", "NINC", "NARR", "NCHG", "NJUD")], 
               key = VName, value = Count, NINC:NJUD)
IDNW$VName <- ordered(IDNW$VName, levels = c("NINC", "NARR", "NCHG", "NJUD"), 
                      labels = c("Incidents", "Arrest Offenses", 
                                 "Prosecutor Charges", "Adjudicated Charges"))
bwplot(VName ~ Count, data = IDNW, factor = 1, xlim = c(-4, 64),
       panel = panel.mybox, par.settings = my.boxes,
       xlab = "Number of Records for Individual Offender")
densityplot(~ Count | VName, data = IDNW, layout = c(4,1), 
            panel = panel.mydensity, jitter.amount = 0.005,
            strip = strip.custom(par.strip.text = list(cex = .7)),
            xlab = "Number of Records for Individual Offender")
rm(IDNW)
```

\FloatBarrier

## Recoding Crime Category Variables
Here we switch over to dummy coding the different crime category variables so 
can summarize data by category. 

```{r}
# Dummy code all the crime category variables in ARR
ARR <- dcode(x = ARR, y = factor(ARR$ACat18, levels = c(1:17, 999)), 
             stem = "ACat18")
ARR <- dcode(x = ARR, y = factor(ARR$ACat12), stem = "ACat12")

# Dummy code all the crime category variables in CHG
CHG <- dcode(x = CHG, y = factor(CHG$CCat18, levels = c(1:17, 999)), 
             stem = "CCat18")
CHG <- dcode(x = CHG, y = factor(CHG$CCat12), stem = "CCat12")

# Dummy code all the crime category variables in JUD
JUD <- dcode(x = JUD, y = factor(JUD$JCat18, levels = c(1:17, 999)), 
             stem = "JCat18")
JUD <- dcode(x = JUD, y = factor(JUD$JCat12), stem = "JCat12")
```

\FloatBarrier

## Aggregating Crime Category Variables
Here we aggregate the dummy coded crime category variables data first to the
incident level to flag presence of each crime category on the incident, then 
to offender level incident counts for each crime category. The incident counts 
are then merged onto the IDN data frame. 

```{r}
# Aggregate ACat12 dummy codes by IID
ARR2 <- aggregate(cbind(ACat12_1,  ACat12_2,  ACat12_3,  ACat12_4,  ACat12_5,
                        ACat12_6,  ACat12_7,  ACat12_8,  ACat12_9,  ACat12_10,
                        ACat12_11, ACat12_12, ACat12_999) ~ OID + IID, 
                  data = ARR, FUN=max)

# Aggregate ACat12 dummy codes by OID into incident count variables
ARR3 <- aggregate(cbind(ACat12_1,  ACat12_2,  ACat12_3,  ACat12_4,  ACat12_5,
                        ACat12_6,  ACat12_7,  ACat12_8,  ACat12_9,  ACat12_10,
                        ACat12_11, ACat12_12, ACat12_999) ~ OID, 
                  data = ARR2, FUN=sum)

# Merge ACat12 incident count variables into IDN
IDN <- merge(x = IDN, y = ARR3, by = "OID", all.x = TRUE)
names(IDN)

# Aggregate CCat12 dummy codes by IID
CHG2 <- aggregate(cbind(CCat12_1,  CCat12_2,  CCat12_3,  CCat12_4,  CCat12_5,
                        CCat12_6,  CCat12_7,  CCat12_8,  CCat12_9,  CCat12_10,
                        CCat12_11, CCat12_12, CCat12_999) ~ OID + IID, 
                  data = CHG, FUN=max)

# Aggregate CCat12 dummy codes by OID into incident count variables
CHG3 <- aggregate(cbind(CCat12_1,  CCat12_2,  CCat12_3,  CCat12_4,  CCat12_5,
                        CCat12_6,  CCat12_7,  CCat12_8,  CCat12_9,  CCat12_10,
                        CCat12_11, CCat12_12, CCat12_999) ~ OID, 
                  data = CHG2, FUN=sum)

# Merge CCat12 incident count variables into IDN
IDN <- merge(x = IDN, y = CHG3, by = "OID", all.x = TRUE)
names(IDN)

# Aggregate JCat12 dummy codes by IID (subset by JDispCat = 1 returns convictions)
JUD2 <- aggregate(cbind(JCat12_1,  JCat12_2,  JCat12_3,  JCat12_4,  JCat12_5,
                        JCat12_6,  JCat12_7,  JCat12_8,  JCat12_9,  JCat12_10,
                        JCat12_11, JCat12_12, JCat12_999) ~ OID + IID, 
                  data = JUD[JUD$JDispCat == 1,], FUN=max)

# Aggregate JCat12 dummy codes by OID into incident count variables
JUD3 <- aggregate(cbind(JCat12_1,  JCat12_2,  JCat12_3,  JCat12_4,  JCat12_5,
                        JCat12_6,  JCat12_7,  JCat12_8,  JCat12_9,  JCat12_10,
                        JCat12_11, JCat12_12, JCat12_999) ~ OID, 
                  data = JUD2, FUN=sum)

# Merge JCat12 incident count variables into IDN
IDN <- merge(x = IDN, y = JUD3, by = "OID", all.x = TRUE)

# Vector of incident count variables names to be recoded.
avars <- paste("ACat12", c(1:12, 999), sep = "_")
cvars <- paste("CCat12", c(1:12, 999), sep = "_")
jvars <- paste("JCat12", c(1:12, 999), sep = "_") 
vars <- c(avars, cvars, jvars)

# Recode every variable named in vars to replace NA with 0. 
IDN[, vars] <- apply(IDN[, vars], 2, function(x) {x <- recode(x, "NA=0"); x})

# Verify that OCSC1 = ACat12_5, OCSC2 = CCat12_5, & OCSC3 = JCat12_5.
# This compares incident count variables created in SPSS to corresponding 
# variables created in R above (to prove logic was implemented the same way).
all(IDN$OCSC1 == IDN$ACat12_5) # Arrest incident counts
all(IDN$OCSC2 == IDN$CCat12_5) # Charge incident counts
all(IDN$OCSC3 == IDN$JCat12_5) # Conviction incident counts

# Count the number of crime categories associated w/ each offender.
IDN$ACat12_Count <- rowSums(IDN[, avars[1:12]] > 0) # Arrest category counts
IDN$CCat12_Count <- rowSums(IDN[, cvars[1:12]] > 0) # Charge category counts
IDN$JCat12_Count <- rowSums(IDN[, jvars[1:12]] > 0) # Conviction category counts
```

\FloatBarrier

## Crime Category Count
Here we are summarizing how many of 12 different categories of crime each 
offender was *arrested for*, *charged with*, and *convicted of* according to 
the CHR data. This sums a set of binary transforms on the incident count 
variables associated with each crime category in ACat12, CCat12, and JCat12. The
*Excluded user-missing* value is not counted as a category, so the possible
range of values for this count is 0-12.

```{r}
CCC <- describe(IDN[, c("ACat12_Count", "CCat12_Count", "JCat12_Count")],
                quant=c(.25, .50, .75))
RN.CCC <- c("Crime category count (arrested)", 
            "Crime category count (charged)", 
            "Crime category count (convicted)")
row.names(CCC) <- RN.CCC
kable(CCC[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Crime Category Counts")

kable(freq(IDN$ACat12_Count), digits = 2, 
      caption = "Crime Category Count (With Arrests)")

kable(freq(IDN$CCat12_Count), digits = 2,
      caption = "Crime Category Count (With Charges)")

kable(freq(IDN$JCat12_Count), digits = 2,
      caption = "Crime Category Count (With Convictions)")
```

\FloatBarrier

## Incident Counts by Crime Category (12 levels)
In this section, we analyze variables that contain the number of unique 
incidents in the offender's criminal history for a given type of crime. We have three separate counts for each category of crime, representing incidents where 
the offender was *arrested for*, *charged with*, or *convicted of* crimes  
classified into that category. Note that these variables were created by first
aggregating ARR, CHG, and JUD records to the incident level to flag incidents
that fit the relevant category, then aggregated again to get to the offender
level. It is possible to have multiple arrest offense records, charge records, 
or adjudication records for convictions on a single incident, but these 
variables ignore that and only count each incident once. 

\FloatBarrier

### Arson 
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* arson.

```{r}
RN.ACC <- c("Incident count (arrested)", 
            "Incident count (charged)", 
            "Incident count (convicted)")
ACat12_1 <- describe(IDN[, c("ACat12_1", "CCat12_1", "JCat12_1")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_1) <- RN.ACC
kable(ACat12_1[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Arson Incident Counts")
```

\FloatBarrier

### Assault - DV, Stalking 
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* assaults involving domestic
violence and/or stalking.

```{r}
ACat12_2 <- describe(IDN[, c("ACat12_2", "CCat12_2", "JCat12_2")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_2) <- RN.ACC
kable(ACat12_2[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Assault - DV, Stalking Incident Counts")
```

\FloatBarrier

### Assault - Non-Sexual, Non-DV 
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* assaults that were non-sexual
and did not involve domestic violence. 

```{r}
ACat12_3 <- describe(IDN[, c("ACat12_3", "CCat12_3", "JCat12_3")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_3) <- RN.ACC
kable(ACat12_3[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Assault - Non-Sexual, Non-DV Incident Counts")
```

\FloatBarrier

### Burglary 
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* burglary.

```{r}
ACat12_4 <- describe(IDN[, c("ACat12_4", "CCat12_4", "JCat12_4")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_4) <- RN.ACC
kable(ACat12_4[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Burglary Incident Counts")
```

\FloatBarrier

### Criminal Sexual Conduct
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* criminal sexual conduct.

Note: We actually have redundant sets of variables that contain these particular
counts. The variables OCSC1-OCSC3 were created and stored in the SPSS file; the
variables ACat12_5, CCat12_5, and JCat12_5 contain exactly the same data, but 
were created above in the **Aggregating Crime Category Variables** section. 

```{r}
CSC <- describe(IDN[, c("OCSC1", "OCSC2", "OCSC3")], quant=c(.25, .50, .75))
kable(CSC[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Criminal Sexual Conduct Incident Counts")

kable(freq(IDN$OCSC1), digits = 2, 
      caption = "Criminal Sexual Conduct Incident Count (With Arrests)")

kable(freq(IDN$OCSC2), digits = 2,
      caption = "Criminal Sexual Conduct Incident Count (With Charges)")

kable(freq(IDN$OCSC3), digits = 2,
      caption = "Criminal Sexual Conduct Incident Count (With Convictions)")
```

```{r}
# Check how many offenders had > 1 CSC arrest, > 1 CSC charge, and/or > 1 CSC 
# conviction in their CHR data. 
nrow(IDN[with(IDN, OCSC1 > 1 | OCSC2 > 1 | OCSC3 > 1),]) 
```

```{r , fig.height = 3, warning= FALSE}
# Rearrange data so we can easily plot multiple variables. 
IDNW <- gather(data = IDN[, c("OID", "OCSC1", "OCSC2", "OCSC3")], 
               key = VName, value = Count, OCSC1:OCSC3)
IDNW$VName <- ordered(IDNW$VName, levels = c("OCSC1", "OCSC2", "OCSC3"), 
                      labels = c("Arrests", "Charges", "Convictions"))
densityplot(~ Count | VName, data = IDNW, layout = c(3,1), 
            panel = panel.mydensity, jitter.amount = 0.1,
            strip = strip.custom(par.strip.text = list(cex = 1)),
            xlab = "Number of Incidents with Criminal Sexual Conduct")
rm(IDNW)
```

\FloatBarrier

### Drug Crime 
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* drug crimes.

```{r}
ACat12_6 <- describe(IDN[, c("ACat12_6", "CCat12_6", "JCat12_6")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_6) <- RN.ACC
kable(ACat12_6[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Drug Crime Incident Counts")
```

\FloatBarrier

### Homicide 
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* homicide.

```{r}
ACat12_7 <- describe(IDN[, c("ACat12_7", "CCat12_7", "JCat12_7")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_7) <- RN.ACC
kable(ACat12_7[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Homicide Incident Counts")
```

\FloatBarrier

### Larceny/Theft/Fraud 
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* larceny, theft, or fraud. 

```{r}
ACat12_8 <- describe(IDN[, c("ACat12_8", "CCat12_8", "JCat12_8")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_8) <- RN.ACC
kable(ACat12_8[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Larceny, Theft, or Fraud Incident Counts")
```

\FloatBarrier

### Robbery
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* robbery.

```{r}
ACat12_9 <- describe(IDN[, c("ACat12_9", "CCat12_9", "JCat12_9")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_9) <- RN.ACC
kable(ACat12_9[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Robbery Incident Counts")
```

\FloatBarrier

### Sex Crimes
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* sex crimes (excluding 
criminal sexual conduct).

```{r}
ACat12_10 <- describe(IDN[, c("ACat12_10", "CCat12_10", "JCat12_10")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_10) <- RN.ACC
kable(ACat12_10[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Sex Crime Incident Counts")
```

\FloatBarrier

### Traffic & Ordinances
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* traffic crimes and violations
of ordinances.

```{r}
ACat12_11 <- describe(IDN[, c("ACat12_11", "CCat12_11", "JCat12_11")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_11) <- RN.ACC
kable(ACat12_11[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Traffic & Ordinance Incident Counts")
```

\FloatBarrier

### Weapons
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* weapons crimes.

```{r}
ACat12_12 <- describe(IDN[, c("ACat12_12", "CCat12_12", "JCat12_12")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_12) <- RN.ACC
kable(ACat12_12[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Weapons Incident Counts")
```

\FloatBarrier

### Other Crimes (Excluded User-Missing)
Here we summarize the counts of unique incidents where the offender was 
*arrested for*, *charged with*, and *convicted of* any other type of crime not
included in the other tables above this section.

```{r}
ACat12_999 <- describe(IDN[, c("ACat12_999", "CCat12_999", "JCat12_999")], 
                  quant=c(.25, .50, .75))
row.names(ACat12_999) <- RN.ACC
kable(ACat12_999[, CNums], digits = 2, col.names = CNames,
      caption = "Offender-Level Other Crime (Excluded User-Missing) Incident Counts")
```

********************************************************************************
\FloatBarrier

# Arrest Offense Record Summaries
All summaries in this section directly summarize the ARR data without first 
aggregating to the incident or offender level. 

\FloatBarrier

## Crime Category (12 levels)
```{r}
kable(freq(as_factor(ARR$ACat12), user.missing = "Excluded user-missing"), 
      digits = 2, format.args = list(big.mark = ','),
      caption = "Number of Arrest Offense Records by Crime Category (12 levels)")
```

\FloatBarrier

## Age at Arrest for Criminal Sexual Conduct
```{r}
OAgeA <- describe(ARR[ARR$ACat12 == 5, "OAgeA"],  quant=c(.25, .50, .75))
kable(OAgeA[, CNums], digits = 2, col.names = CNames,
      caption = "Offender Age at Arrest for Criminal Sexual Conduct")
```

********************************************************************************
\FloatBarrier

# Prosecutor Charge Record Summaries
All summaries in this section directly summarize the CHG data without first 
aggregating to the incident or offender level. 

\FloatBarrier

## Crime Category (12 levels)
```{r, fig.height = 2}
kable(freq(as_factor(CHG$CCat12), user.missing = "Excluded user-missing"), 
      digits = 2, format.args = list(big.mark = ','),
      caption = "Number of Prosecutor Charge Records by Crime Category (12 levels)")
```

********************************************************************************
\FloatBarrier

# Judicial Charge Record Summaries
All summaries in this section directly summarize the JUD data without first 
aggregating to the incident or offender level. Note that here we do not
distinguish between adjudicated charge records based on disposition. While
some of these records are convictions, others will have other dispositions.

\FloatBarrier

## Crime Category (12 levels, all dispositions)
```{r, fig.height = 2}
kable(freq(as_factor(JUD$JCat12), user.missing = "Excluded user-missing"), 
      digits = 2, format.args = list(big.mark = ','),
      caption = "Number of Adjudicated Charge Records (All Dispositions) by Crime Category (12 levels)")
```

\FloatBarrier

## Crime Category (12 levels, convictions)
```{r, fig.height = 2}
kable(freq(as_factor(JUD$JCat12[JUD$JDispCat == 1]), 
           user.missing = "Excluded user-missing"), 
      digits = 2, format.args = list(big.mark = ','),
      caption = "Number of Adjudicated Charge Records (Convictions Only) by Crime Category (12 levels)")
```

********************************************************************************
# Wrap Up

\FloatBarrier

## Project Information
These materials are scholarly products based on research funded by the following 
grant. 

Campbell, R., Pierce, S. J., & Sharma, D. (01/01/2015–12/31/2018). Serial sexual
assaults: A longitudinal examination of offending patterns using DNA evidence.
[NIJ Award # 2014-NE-BX-0006, Awarded, $699,533]. Sponsor: National Institute of
Justice. Location: Michigan State University, East Lansing, MI.

\FloatBarrier

## References
Campbell, R. (2019). *Serial sexual assaults: A longitudinal examination of
offending patterns using DNA evidence, Detroit, Michigan, 2009* [Data files,
codebooks, computer programs, and statistical output]. ICPSR37134-v1. Ann Arbor,
MI: Inter-university Consortium for Political and Social Research [distributor],
2019-02-28. Retrieved from: https://doi.org/10.3886/ICPSR37134.v1


\FloatBarrier

## Document Information
Folder: *`r getwd()`*

* Script: *`r knitr:::current_input()`*
* Output: *`r sub(".Rmd", ".pdf", knitr:::current_input())`*

\FloatBarrier

## Software Information
We use R Markdown to enhance reproducibility. Knitting the R Markdown script
generates the PDF file containing explanatory text, R code, plus R output 
(text and graphics) noted in the Document Information section above.

- We use [RStudio (version 1.2.5033 or later)](www.rstudio.org) to work with 
  R and R markdown files. The software chain looks like this:
  **Rmd file -> RStudio -> R -> knitr -> pandoc -> MiKTeX -> PDF file**.
- We recommend using [TinyTeX](https://yihui.org/tinytex/) to compile LaTeX files 
  into PDF files. However, it should be viable to use 
  [MiKTeX version 2.9](https://miktex.org) instead. 
  

``` {r show_citations}
sessionInfo()
citation("here")
citation("dplyr")
citation("tidyr")
citation("rmarkdown")
citation("knitr")
citation("kableExtra")
citation("descr")
citation("lubridate")
citation("sjlabelled")
citation("haven")
citation("lattice")
citation("plyr")
citation("psych")
citation("car")
```
